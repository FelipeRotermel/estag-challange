/* A */

CREATE TABLE CUSTOMER (
	CDCUSTOMER INT IDENTITY(1,1) NOT NULL,
	NMCUSTOMER VARCHAR(60) NOT NULL,
	NRFONE DECIMAL(13) NOT NULL,
	DSADRESS VARCHAR(50) NOT NULL,
);

CREATE TABLE REQUEST (
	CDREQUEST INT IDENTITY(1,1) NOT NULL,
	DTREQUEST DATE DEFAULT GETDATE(),
	CDCUSTOMER INT NOT NULL,
    DTDELEVIER DATE DEFAULT GETDATE(),
    VLTOTAL DECIMAL(30,2) NOT NULL,
);

CREATE TABLE SUPPLIER (
	CDSUPPLIER INT IDENTITY(1,1) NOT NULL,
	NMSUPPLIER VARCHAR(100) NOT NULL,
	NRFONE DECIMAL(13) NOT NULL,
);

CREATE TABLE PRODUCT (
    CDPRODUCT INT IDENTITY(1,1) NOT NULL,
    NMPRODUCT VARCHAR(100) NOT NULL,
    CDSUPPLIER INT NOT NULL,
    VLPRICE DECIMAL(30,2) NOT NULL,
    QTSTOCK INT NOT NULL,
);

CREATE TABLE PRODUCTREQUEST (
    CDREQUEST INT NOT NULL,
    CDPRODUCT INT NOT NULL,
    QTAMOUNT INT NOT NULL,
    VLUNITARY INT NOT NULL,
);


/* B */

ALTER TABLE CUSTOMER ADD PRIMARY KEY ( CDCUSTOMER );
ALTER TABLE REQUEST ADD PRIMARY KEY ( CDREQUEST );
ALTER TABLE SUPPLIER ADD PRIMARY KEY ( CDSUPPLIER );
ALTER TABLE PRODUCT ADD PRIMARY KEY ( CDPRODUCT );

/* C */

ALTER TABLE REQUEST ADD CONSTRAINT FK_CUSTOMER FOREIGN KEY ( CDCUSTOMER ) REFERENCES CUSTOMER( CDCUSTOMER );
ALTER TABLE PRODUCT ADD CONSTRAINT FK_SUPPLIER FOREIGN KEY ( CDSUPPLIER ) REFERENCES SUPPLIER( CDSUPPLIER );
ALTER TABLE PRODUCTREQUEST ADD CONSTRAINT FK_REQUEST FOREIGN KEY ( CDREQUEST ) REFERENCES REQUEST( CDREQUEST );
ALTER TABLE PRODUCTREQUEST ADD CONSTRAINT FK_PRODUCT FOREIGN KEY ( CDPRODUCT ) REFERENCES PRODUCT( CDPRODUCT );
 
/* D */

CREATE INDEX INDEX_PRODUCT_FK ON PRODUCT( CDSUPPLIER );

/* E */

CREATE INDEX INDEX_REQUEST_FK ON REQUEST( CDCUSTOMER );

/* F */

ALTER TABLE SUPPLIER ADD DSADRESS VARCHAR(50) NOT NULL;

/* G */

INSERT INTO CUSTOMER ( NMCUSTOMER, NRFONE, DSADRESS ) VALUES ( 'Fabiano', 99879375, 'Rua Tijucas, 110, Centro, Joinville - S.C' );

/* H */

INSERT INTO REQUEST ( DTREQUEST, CDCUSTOMER, DTDELEVIER, VLTOTAL ) VALUES ( '2008-01-31' , 1, '2008-02-05', 54 );

/* I */

UPDATE CUSTOMER SET NRFONE = 99012567 WHERE NMCUSTOMER = 'Fabiano';

/* J */

DELETE FROM REQUEST WHERE CDCUSTOMER = 1;
DELETE FROM CUSTOMER WHERE NMCUSTOMER = 'Fabiano';

/* K */

DROP TABLE PRODUCTREQUEST, REQUEST, PRODUCT, CUSTOMER, SUPPLIER;