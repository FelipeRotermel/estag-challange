/* A */

DELETE FROM PRODUCTREQUEST
WHERE PRODUCTREQUEST.CDREQUEST IN (
    SELECT PRODUCTREQUEST.CDREQUEST
    FROM PRODUCTREQUEST
    INNER JOIN REQUEST ON PRODUCTREQUEST.CDREQUEST = REQUEST.CDREQUEST
    WHERE REQUEST.DTREQUEST LIKE '%2003-06%'
	AND PRODUCTREQUEST.CDPRODUCT IS NULL
    GROUP BY PRODUCTREQUEST.CDREQUEST
    HAVING SUM(VLUNITARY * QTAMOUNT) < 1000
);

/* B */

UPDATE PRODUCT
SET PRODUCT.VLPRICE = (
	SELECT AVG(PRODUCTREQUEST.VLUNITARY)
	FROM PRODUCTREQUEST
)
WHERE PRODUCT.CDPRODUCT IN (
    SELECT PRODUCT.CDPRODUCT
    FROM PRODUCTREQUEST
    GROUP BY PRODUCTREQUEST.CDPRODUCT
    HAVING SUM(PRODUCTREQUEST.QTAMOUNT) < 800
);

/* C */

INSERT INTO CUSTOMER (CDCUSTOMER, NMCUSTOMER, IDFONE, NMADRESS) 
SELECT  MAX(CUSTOMER.CDCUSTOMER) + CDSUPPLIER, NMSUPPLIER, SUPPLIER.IDFONE, 'DESCONHECIDO' FROM  SUPPLIER, CUSTOMER
GROUP BY NMSUPPLIER, CDSUPPLIER, SUPPLIER.IDFONE;

/* D */

UPDATE REQUEST 
SET REQUEST.DTDELIVER = DATEADD(day, 30, REQUEST.DTREQUEST) 
WHERE DATEDIFF(day,REQUEST.DTREQUEST,REQUEST.DTDELIVER) < 10 
AND REQUEST.VLTOTAL < 10000;