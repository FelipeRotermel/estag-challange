--1

/* A */

DELETE FROM CUSTOMER
WHERE CUSTOMER.CDCUSTOMER IN (
    SELECT CUSTOMER.CDCUSTOMER
    FROM CUSTOMER
    INNER JOIN REQUEST ON CUSTOMER.CDCUSTOMER = REQUEST.CDCUSTOMER
    GROUP BY CUSTOMER.CDCUSTOMER
    HAVING COUNT(REQUEST.CDREQUEST) < 1
);

/* B */

DELETE FROM SUPPLIER
WHERE SUPPLIER.NMSUPPLIER IN (
	SELECT SUPPLIER.NMSUPPLIER
	FROM SUPPLIER INNER JOIN PRODUCT ON SUPPLIER.CDSUPPLIER = PRODUCT.CDSUPPLIER
	GROUP BY SUPPLIER.NMSUPPLIER
	HAVING COUNT(PRODUCT.NMPRODUCT) < 1
);

/* C */

UPDATE PRODUCTREQUEST 
SET PRODUCTREQUEST.VLUNITARY = PRODUCT.VLPRICE 
FROM PRODUCTREQUEST JOIN PRODUCT ON PRODUCTREQUEST.CDPRODUCT = PRODUCT.CDPRODUCT;

/* D */

ALTER TABLE SUPPLIER ADD dsstatus VARCHAR(10);

/* E */

UPDATE SUPPLIER
SET dsstatus = 'INATIVO'
WHERE CDSUPPLIER NOT IN (SELECT CDSUPPLIER FROM PRODUCT);

/* F */

UPDATE CUSTOMER SET NMADRESS = 'DESCONHECIDO' WHERE NMADRESS IS NULL;

/* G */

UPDATE PRODUCTREQUEST
SET PRODUCTREQUEST.VLUNITARY = PRODUCT.VLPRICE,
PRODUCTREQUEST.QTAMOUNT = 10
FROM PRODUCTREQUEST JOIN PRODUCT ON PRODUCTREQUEST.CDPRODUCT = PRODUCT.CDPRODUCT;

--2

/* A */

SELECT PRODUCT.NMPRODUCT, COUNT(PRODUCTREQUEST.QTAMOUNT) AS QTBUY, SUM(PRODUCTREQUEST.QTAMOUNT) AS QTTOTAL, SUM(PRODUCTREQUEST.VLUNITARY * PRODUCTREQUEST.QTAMOUNT) AS VLTOTAL
FROM PRODUCTREQUEST
INNER JOIN PRODUCT ON PRODUCTREQUEST.CDPRODUCT = PRODUCT.CDPRODUCT
INNER JOIN REQUEST ON PRODUCTREQUEST.CDREQUEST = REQUEST.CDREQUEST
INNER JOIN CUSTOMER ON REQUEST.CDCUSTOMER = CUSTOMER.CDCUSTOMER
GROUP BY PRODUCT.NMPRODUCT, PRODUCTREQUEST.QTAMOUNT;

/* B */

SELECT COUNT(REQUEST.CDREQUEST) AS TOTALREQUEST, REQUEST.VLTOTAL, CUSTOMER.NMCUSTOMER
FROM REQUEST
INNER JOIN CUSTOMER ON REQUEST.CDCUSTOMER = CUSTOMER.CDCUSTOMER
WHERE REQUEST.DTREQUEST LIKE '%2003%'
GROUP BY REQUEST.VLTOTAL, CUSTOMER.NMCUSTOMER;

/* C */

SELECT SUPPLIER.NMSUPPLIER, SUPPLIER.IDFONE, PRODUCT.NMPRODUCT, PRODUCT.VLPRICE, PRODUCT.QTSTOCK
FROM SUPPLIER
LEFT JOIN PRODUCT ON SUPPLIER.CDSUPPLIER = PRODUCT.CDSUPPLIER;

/* D */

SELECT CUSTOMER.NMCUSTOMER, REQUEST.DTREQUEST, REQUEST.VLTOTAL
FROM CUSTOMER
LEFT JOIN REQUEST ON CUSTOMER.CDCUSTOMER = REQUEST.CDCUSTOMER;
